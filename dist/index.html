<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚖️</text></svg>" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>🏛️ سیستم آرشیو اسناد حقوقی ایران</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="سیستم پیشرفته آرشیو اسناد حقوقی ایران با قابلیت تحلیل هوشمند، مدیریت پروکسی و پردازش بلادرنگ" />
    <meta name="keywords" content="آرشیو حقوقی، اسناد حقوقی ایران، تحلیل هوشمند، پردازش اسناد، سیستم حقوقی" />
    <meta name="author" content="تیم سیستم آرشیو حقوقی ایران" />
    <meta name="robots" content="index, follow" />
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="سیستم آرشیو اسناد حقوقی ایران" />
    <meta property="og:description" content="سیستم پیشرفته آرشیو اسناد حقوقی ایران با قابلیت تحلیل هوشمند" />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="fa_IR" />
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="سیستم آرشیو اسناد حقوقی ایران" />
    <meta name="twitter:description" content="سیستم پیشرفته آرشیو اسناد حقوقی ایران با قابلیت تحلیل هوشمند" />
    
    <!-- Preload critical fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Theme color for mobile browsers -->
    <meta name="theme-color" content="#3b82f6" />
    <meta name="msapplication-TileColor" content="#3b82f6" />
    
    <!-- Manifest for PWA -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogItiz24zYs9iq2YUg2KLYsdi024zZiCDYp9iz2YbYp9ivINit2YLZiNmC24wg2KfbjNix2KfZhiIsCiAgInNob3J0X25hbWUiOiAi2KLYsdi024zZiCDYrdmC2YjZgtuMIiwKICAiZGVzY3JpcHRpb24iOiAi2LPbjNiz2KrZhSDZvtuM2LTYsdmB2KrZhyDYotix2LTbjNmIINin2LPZhtin2K8g2K3ZgtmI2YLbjCDYp9uM2LHYp9mGINio2Kcg2YLYp9io2YTbjNiqINiq2K3ZhNuM2YQg2YfZiNi02YXZhtivINmIINin2LPYqtiu2LHYp9isINiv2KfYr9mHIiwKICAic3RhcnRfdXJsIjogIi9BaWhvZ2hvZ2hpLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2ZmZmZmZiIsCiAgInRoZW1lX2NvbG9yIjogIiMzYjgyZjYiLAogICJvcmllbnRhdGlvbiI6ICJwb3J0cmFpdC1wcmltYXJ5IiwKICAic2NvcGUiOiAiL0FpaG9naG9naGkvIiwKICAibGFuZyI6ICJmYSIsCiAgImRpciI6ICJydGwiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWwsPHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAxMDAgMTAwJz48dGV4dCB5PScuOWVtJyBmb250LXNpemU9JzkwJz7impbvuI88L3RleHQ+PC9zdmc+IiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfSwKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWwsPHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAxMDAgMTAwJz48dGV4dCB5PScuOWVtJyBmb250LXNpemU9JzkwJz7impbvuI88L3RleHQ+PC9zdmc+IiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0sCiAgImNhdGVnb3JpZXMiOiBbInByb2R1Y3Rpdml0eSIsICJ1dGlsaXRpZXMiLCAiYnVzaW5lc3MiXSwKICAic2hvcnRjdXRzIjogWwogICAgewogICAgICAibmFtZSI6ICLYrNiz2KrYrNmIINiv2LEg2KfYs9mG2KfYryIsCiAgICAgICJzaG9ydF9uYW1lIjogItis2LPYqtis2YgiLAogICAgICAiZGVzY3JpcHRpb24iOiAi2KzYs9iq2KzZiCDYr9ixINm+2KfbjNqv2KfZhyDYr9in2K/ZhyDYp9iz2YbYp9ivINit2YLZiNmC24wiLAogICAgICAidXJsIjogIi9BaWhvZ2hvZ2hpL3NlYXJjaCIsCiAgICAgICJpY29ucyI6IFsKICAgICAgICB7CiAgICAgICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbCw8c3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDEwMCAxMDAnPjx0ZXh0IHk9Jy45ZW0nIGZvbnQtc2l6ZT0nOTAnPvCflI08L3RleHQ+PC9zdmc+IiwKICAgICAgICAgICJzaXplcyI6ICI5Nng5NiIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogItm+2LHYr9in2LLYtCDYp9iz2YbYp9ivIiwKICAgICAgInNob3J0X25hbWUiOiAi2b7Ysdiv2KfYsti0IiwKICAgICAgImRlc2NyaXB0aW9uIjogItii2b7ZhNmI2K8g2Ygg2b7Ysdiv2KfYsti0INin2LPZhtin2K8g2KzYr9uM2K8iLAogICAgICAidXJsIjogIi9BaWhvZ2hvZ2hpL3Byb2Nlc3MiLAogICAgICAiaWNvbnMiOiBbCiAgICAgICAgewogICAgICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWwsPHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAxMDAgMTAwJz48dGV4dCB5PScuOWVtJyBmb250LXNpemU9JzkwJz7wn5OEPC90ZXh0Pjwvc3ZnPiIsCiAgICAgICAgICAic2l6ZXMiOiAiOTZ4OTYiCiAgICAgICAgfQogICAgICBdCiAgICB9CiAgXQp9" />
    
    <!-- Preload critical resources -->
    <script>
      // Detect if we're on GitHub Pages or local/other deployment
      const isGitHubPages = window.location.hostname.includes('github.io');
      const basePath = isGitHubPages ? '/Aihoghoghi/' : './';
      
      // Dynamically load CSS (try multiple versions)
      const cssFiles = ['index-c704e190.css', 'index-4ed993c7.css', 'index.css'];
      let cssLoaded = false;
      
      for (const cssFile of cssFiles) {
        try {
          const cssLink = document.createElement('link');
          cssLink.rel = 'stylesheet';
          cssLink.href = basePath + (isGitHubPages ? 'assets/' : 'dist/assets/') + cssFile;
          cssLink.onload = () => {
            if (!cssLoaded) {
              console.log(`✅ CSS loaded: ${cssFile}`);
              cssLoaded = true;
            }
          };
          cssLink.onerror = () => {
            console.warn(`⚠️ CSS not found: ${cssFile}`);
          };
          document.head.appendChild(cssLink);
          
          if (!cssLoaded) break; // Try only first available
        } catch (error) {
          console.warn(`❌ CSS load error: ${error.message}`);
        }
      }
      
      // Preload resources
      const preloadResources = [
        'index-4ed993c7.js',
        'vendor-4ed993c7.js', 
        'router-4ed993c7.js',
        'charts-4ed993c7.js',
        'query-4ed993c7.js'
      ];
      
      preloadResources.forEach((resource, index) => {
        const link = document.createElement('link');
        if (index === 0) {
          link.rel = 'preload';
          link.as = 'script';
        } else {
          link.rel = 'modulepreload';
        }
        link.crossOrigin = 'anonymous';
        link.href = basePath + (isGitHubPages ? 'assets/' : 'dist/assets/') + resource;
        document.head.appendChild(link);
      });
    </script>
    
    <style>
      /* Critical CSS for initial load */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      html {
        font-family: 'Vazirmatn', 'Tahoma', 'IRANSans', sans-serif;
        direction: rtl;
      }
      
      body {
        background-color: #f9fafb;
        color: #1f2937;
        line-height: 1.6;
      }
      
      @media (prefers-color-scheme: dark) {
        body {
          background-color: #111827;
          color: #f9fafb;
        }
      }
      
      /* Loading spinner */
      .loading-container {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f9fafb;
        z-index: 9999;
      }
      
      @media (prefers-color-scheme: dark) {
        .loading-container {
          background-color: #111827;
        }
      }
      
      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #e5e7eb;
        border-top: 4px solid #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      
      @media (prefers-color-scheme: dark) {
        .loading-spinner {
          border-color: #374151;
          border-top-color: #60a5fa;
        }
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      .loading-text {
        margin-top: 16px;
        color: #6b7280;
        font-size: 14px;
        font-weight: 500;
      }
      
      @media (prefers-color-scheme: dark) {
        .loading-text {
          color: #9ca3af;
        }
      }
    </style>
  </head>
  <body>
    <div id="root">
      <!-- Initial loading state with timeout fallback -->
      <div class="loading-container" id="initial-loader">
        <div style="text-align: center;">
          <div class="loading-spinner"></div>
          <div class="loading-text">در حال بارگذاری سیستم آرشیو حقوقی...</div>
          <div style="margin-top: 1rem; font-size: 0.8rem; opacity: 0.7;" id="loading-progress">
            آماده‌سازی اجزا...
          </div>
        </div>
      </div>
    </div>
    
    <script>
      // Auto-startup system for Iranian Legal Archive
      window.iranianLegalArchive = {
        isGitHubPages: window.location.hostname.includes('github.io'),
        basePath: window.location.hostname.includes('github.io') ? '/Aihoghoghi/' : './',
        startupTime: Date.now(),
        sessionId: Date.now().toString(36) + Math.random().toString(36).substr(2),
        features: {
          smartProxy: true,
          iranianDNS: true,
          autoScraping: true,
          realTimeAnalysis: true,
          backgroundSync: true
        }
      };

      // Log system startup
      console.log('🚀 Iranian Legal Archive System Starting...');
      console.log('📍 Environment:', window.iranianLegalArchive.isGitHubPages ? 'GitHub Pages' : 'Local');
      console.log('🆔 Session ID:', window.iranianLegalArchive.sessionId);
      
      // Dynamically load the main React app script
      const { isGitHubPages, basePath } = window.iranianLegalArchive;
      const scriptSrc = basePath + (isGitHubPages ? 'assets/' : 'dist/assets/') + 'index-4ed993c7.js';
      
      const script = document.createElement('script');
      script.type = 'module';
      script.crossOrigin = 'anonymous';
      script.src = scriptSrc;
      script.onload = () => {
        console.log('✅ React app loaded successfully');
        window.iranianLegalArchive.reactLoaded = true;
      };
      script.onerror = () => {
        console.error('❌ Failed to load React app');
        window.iranianLegalArchive.reactError = true;
      };
      document.head.appendChild(script);

      // Initialize background services
      window.iranianLegalArchive.initializeServices = async () => {
        console.log('⚙️ Initializing background services...');
        
        try {
          // Setup service worker for offline functionality
          if ('serviceWorker' in navigator) {
            const registration = await navigator.serviceWorker.register('./sw.js');
            console.log('✅ Service Worker registered');
            window.iranianLegalArchive.serviceWorker = registration;
          }

          // Setup IndexedDB for client-side storage
          const dbRequest = indexedDB.open('IranianLegalArchive', 1);
          dbRequest.onupgradeneeded = (event) => {
            const db = event.target.result;
            
            if (!db.objectStoreNames.contains('documents')) {
              const store = db.createObjectStore('documents', { keyPath: 'id', autoIncrement: true });
              store.createIndex('url', 'url', { unique: false });
              store.createIndex('category', 'category', { unique: false });
            }
            
            if (!db.objectStoreNames.contains('scrapingResults')) {
              db.createObjectStore('scrapingResults', { keyPath: 'id', autoIncrement: true });
            }
          };
          
          dbRequest.onsuccess = () => {
            window.iranianLegalArchive.database = dbRequest.result;
            console.log('✅ IndexedDB initialized');
          };

          // Setup auto-scraping interval
          if (window.iranianLegalArchive.features.autoScraping) {
            setInterval(() => {
              console.log('🔄 Auto-scraping check...');
              // This will be handled by React components when loaded
              if (window.autoStartupService) {
                window.autoStartupService.performHealthCheck();
              }
            }, 30 * 60 * 1000); // Every 30 minutes
          }

          console.log('✅ All background services initialized');
          window.iranianLegalArchive.servicesReady = true;
          
        } catch (error) {
          console.error('❌ Service initialization failed:', error);
          window.iranianLegalArchive.servicesError = error.message;
        }
      };

      // Load auto-startup services dynamically
      const loadAutoStartupServices = async () => {
        try {
          // Create script elements for services
          const scripts = [
            'smartProxyService.js',
            'advancedScrapingService.js', 
            'autoStartupService.js',
            'githubPagesConfig.js'
          ];
          
          for (const scriptName of scripts) {
            const script = document.createElement('script');
            script.type = 'module';
            script.src = basePath + (isGitHubPages ? 'assets/' : 'dist/assets/') + scriptName;
            script.onload = () => console.log(`✅ Loaded: ${scriptName}`);
            script.onerror = () => console.warn(`⚠️ Failed to load: ${scriptName}`);
            document.head.appendChild(script);
          }
          
          console.log('✅ Advanced services loading initiated');
        } catch (error) {
          console.warn('⚠️ Advanced services not available, using basic mode:', error.message);
        }
      };

      // Start services after a short delay
      setTimeout(async () => {
        await loadAutoStartupServices();
        await window.iranianLegalArchive.initializeServices();
      }, 2000);
    </script>
    
    <!-- Loading timeout fallback script -->
    <script>
      // Prevent infinite loading by implementing timeout fallback
      let progressMessages = [
        'آماده‌سازی اجزا...',
        'بارگذاری کتابخانه‌ها...',
        'اتصال به سرویس‌ها...',
        'نهایی‌سازی رابط کاربری...'
      ];
      let messageIndex = 0;
      let progressInterval;
      
      // Update loading progress messages
      const updateProgress = () => {
        const progressEl = document.getElementById('loading-progress');
        if (progressEl && messageIndex < progressMessages.length) {
          progressEl.textContent = progressMessages[messageIndex];
          messageIndex++;
        }
      };
      
      // Start progress updates
      progressInterval = setInterval(updateProgress, 800);
      
      // Store timeout reference globally so React can clear it
      window.loadingTimeout = setTimeout(() => {
        const loader = document.getElementById('initial-loader');
        if (loader && loader.style.display !== 'none') {
          console.warn('⚠️ HTML Loading timeout reached, React should take over soon');
          
          // Don't force override - let React handle it
          // Just show a message that React is loading
          const progressEl = document.getElementById('loading-progress');
          if (progressEl) {
            progressEl.textContent = 'در حال راه‌اندازی React...';
            progressEl.style.color = '#f59e0b';
          }
        }
      }, 8000);
      
      // Clear intervals and timeouts when React takes over
      window.addEventListener('load', () => {
        setTimeout(() => {
          if (progressInterval) {
            clearInterval(progressInterval);
          }
        }, 1000);
      });
      
      // Clean up function for React to call
      window.cleanupHTMLLoader = () => {
        if (window.loadingTimeout) {
          clearTimeout(window.loadingTimeout);
        }
        if (progressInterval) {
          clearInterval(progressInterval);
        }
      };
    </script>
    
    <!-- Service Worker Registration -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('./sw.js')
            .then(function(registration) {
              console.log('SW registered: ', registration);
            })
            .catch(function(registrationError) {
              console.log('SW registration failed: ', registrationError);
            });
        });
      }
    </script>
  </body>
</html>